	PROGRAM STARTRK
C*********************************************************************
C*                                                                   *
C*                       THE STAR TREK GAME                          *
C*                               BY                                  *
C*               DAVID MATUSZEK AND PAUL REYNOLDS                    *
C*                                                                   *
C*              WITH MODIFICATIONS AND ADDITIONS BY                  *
C*                           DON SMITH                               *
C*                                                                   *
C*                                                                   *
C*         PERMISSION IS HEREBY GRANTED FOR THE COPYING,             *
C*    DISTRIBUTION, MODIFICATION AND USE OF THIS PROGRAM AND         *
C*    ASSOCIATED DOCUMENTATION FOR RECREATIONAL PURPOSES,            *
C*    PROVIDED THAT ALL REFERENCES TO THE AUTHORS ARE RETAINED.      *
C*    HOWEVER, PERMISSION IS NOT AND WILL NOT BE GRANTED FOR         *
C*    THE SALE OR PROMOTIONAL USE OF THIS PROGRAM OR PROGRAM         *
C*    DOCUMENTATION, OR FOR USE IN ANY SITUATION IN WHICH            *
C*    PROFIT MAY BE CONSIDERED AN OBJECTIVE, SINCE IT IS THE         *
C*    DESIRE OF THE AUTHORS TO RESPECT THE COPYRIGHTS OF THE         *
C*    ORIGINATORS OF STAR TREK.                                      *
C*                                                                   *
C*********************************************************************
C
C	4-APR-79
C	MAKE COMMAND INPUT REPROMPT AFTER A BLANK LINE WITHOUT
C	TYPING OUT A BUNCH OF GARBAGE.
C	ALSO GET RID OF THE CRAP ABOUT TYPING SOMETHING TO GET
C	YOUR CITATION.
C	13-APR-79
C	ADD EMERGENCY EXIT COMMAND.
C	25-APR-79
C	GET RID OF COMMON /RAN/, WHICH IS NOT REFERENCED.
C	1-MAY-79
C	REDO ALL MODULES TO GET THEIR COMMON FROM AN INCLUDE STATEMENT.
C	THIS SHOULD GREATLY SIMPLIFY MAINTENANCE AND EXTENSION OF THE
C	GAME.
C	ALSO ADD 'GAME' COMMAND TO MAKE LIFE EASIER FOR THE PLAYER ON
C	A SOFT COPY TERMINAL.
C	31-MAY-79
C	CLOSE PRINT FILE AND RESET LUN TO 1 AFTER OUTPUTTING SCORE
C	AND/OR CITATION.
C
	PARAMETER NCOMMDS=23
	INCLUDE 'TREKCOM/LIST'
	INTEGER CROP
	LOGICAL FROZEN
	REAL*8 ITEM,HELPX,TERM,ABAN,DEST,FREE,DEATH,AITEM
	REAL*8 COMMAND(NCOMMDS)
	COMMON/PRLUN/LUN
	COMMON/SCANBF/KEY,AITEM
	EQUIVALENCE (AITEM,ITEM)
	EQUIVALENCE (CRACKS(6),KDIDIT)
C
C	MASTER COMMAND LIST - INCLUDES ALL ABBREVIATABLE COMMANDS
C
      DATA COMMAND/6HSRSCAN,6HLRSCAN,7HPHASERS,7HPHOTONS,4HMOVE,
     +   7HSHIELDS,4HDOCK,7HDAMAGES,5HCHART,7HIMPULSE,4HREST,4HWARP,
     +   6HSTATUS,7HSENSORS,5HORBIT,8HTRANSPOR,4HMINE,8HCRYSTALS,
     +   7HSHUTTLE,7HPLANETS,7HREQUEST,6HEMEXIT,4HGAME/ 
C
C	ALPHANUMERIC DATA
C
      DATA IHEOL,IHREAL,IHALPHA,IHS,IHR,IHC,IHK,IHGREEN,IHRED,IHYELLO,
     +IHDOCKD,IHE,IHF,IHBLANK,IHDOT,IHQUEST,IHP,IHSTAR,IHB/2HEO,2HRE,
     +2HAL,1HS,1HR,1HC,1HK,2HGR,2HRE,2HYE,2HDO,1HE,1HF,
     +1H ,1H.,1H?,1HP,1H*,1HB/
      DATA IHT,IHNUM/1HT,1H#/ 
C
C	DEVICE LIST
C
C	DEVICES ARE:
C	1.  S. R. SENSORS
C	2.  L. R. SENSORS
C	3.  PHASERS
C	4.  PHOTON TUBES
C	5.  LIFE SUPPORT
C	6.  WARP ENGINES
C	7.  IMPULSE ENGINES
C	8.  SHIELDS
C	9.  SUBSPACE RADIO
C	10. SHUTTLE CRAFT
C	11. COMPUTER
C	12. TRANSPORTER
C	13. SHIELD CONTROL
C	14. DEATHRAY
C
	DATA DEVICE/8HS. R. SE,5HNSORS,8HL. R. SE,5HNSORS,
	1 7HPHASERS,1H ,8HPHOTON T,4HUBES,8HLIFE SUP,4HPORT,
	2 8HWARP ENG,4HINES,8HIMPULSE ,7HENGINES,7HSHIELDS,1H ,
	3 8HSUBSPACE,6H RADIO,8HSHUTTLE ,5HCRAFT,8HCOMPUTER,1H ,
	4 8HTRANSPOR,3HTER,8HSHIELD C,6HONTROL,8HDEATHRAY,
	5 1H /
C
C	NON-ABBREVIATABLE COMMAND LIST
C
	DATA HELPX,TERM,ABAN,DEST,FREE,DEATH/'HELP','TERMINAT',
	1 'ABANDON','DESTRUCT','FREEZE','DEATHRAY'/
C
	NDEVICE=14
	ICITE=0
C--------PRINT OUT PRELIMINARY MESSAGES 
      CALL PRELIM 
C--------INITIALIZE AND START NEW GAME
10	CALL CHOOSE(FROZEN)
	IF(FROZEN) GOTO 15
	CALL SETUP
C--------REQUEST NEW COMMAND AND BRANCH TO CODE FOR THAT COMMAND
 15   MOVED=0 
 20   IF(ALLDONE.NE.0) GO TO 9999 
	JUSTIN=0
	TIME=0.
      KDIDIT=0
      CALL PROMPT(10HCOMMAND:  ,10) 
      CALL SCAN 
      DO 30 L=1,NCOMMDS
	IF(CROP(ITEM,COMMAND(L)))
     +   GO TO (100,200,300,400,500,600,700,800,900,1000, 
     +   1100,1200,1300,1400,1450,1500,1550,1600,1650,1670,
     +   1680,1685,1690),L
 30   CONTINUE
      IF(ITEM .EQ. HELPX     ) GO TO 1700
      IF(ITEM .EQ. TERM) GO TO 9000
      IF(ITEM .EQ. ABAN  ) GO TO 1900
      IF(ITEM .EQ. DEST ) GO TO 2000
      IF(ITEM .EQ. FREE   ) GO TO 2100
      IF(ITEM .EQ. DEATH ) GO TO 2200
      IF(KEY .NE. IHEOL) GO TO 40 
C     CALL PROUT(18HBLANK LINE IGNORED,18) 
      GO TO 20
 40   CALL PROUT( 
     +   42HUNRECOGNIZED COMMAND.  LEGAL COMMANDS ARE:,42) 
      CALL PROUT( 
     +   37H   SRSCAN    MOVE      PHASERS   HELP,37)
      CALL PROUT( 
     +   40H   STATUS    IMPULSE   PHOTONS   ABANDON,40)  
      CALL PROUT( 
     +   41H   LRSCAN    WARP      SHIELDS   DESTRUCT,41)
      CALL PROUT( 
     +   42H   CHART     REST      DOCK      TERMINATE,42) 
      CALL PROUT( 
     +   38H   DAMAGES   FREEZE    SENSORS   ORBIT,38) 
      CALL PROUT( 
     +   40H   TRANSPORT MINE      CRYSTALS  SHUTTLE,40)  
      CALL PROUT( 
     +   39H   PLANETS   REQUEST   DEATHRAY  EMEXIT,39)
      CALL PROUT(
     +    7H   GAME,7)
      GO TO 20
C--------SHORT RANGE SCAN 
 100  CALL SRSCAN 
      GO TO 20
C--------LONG RANGE SCAN
 200  CALL LRSCAN 
      GO TO 20
C--------FIRE PHASERS 
 300  CALL PHASERS
 305  IF(IDIDIT .EQ. 0) GO TO 20
 310  CALL ATTACK 
 320  IF(KDIDIT.NE.0) GO TO 2500 
	GO TO 15
C--------FIRE PHOTON TORPEDOS 
 400  CALL PHOTONS
 410  IF(IDIDIT .EQ. 0) GO TO 20
      MOVED=0 
      GO TO 2500
C--------MOVE UNDER WARP DRIVE
 500  IF(MOVED .EQ. 0) GO TO 510
505   MOVED=2     
 510  CALL WARP 
520   IF((IDIDIT.EQ.0).AND.(MOVED.EQ.2)) MOVED=1  
      IF(IDIDIT.EQ.0) GO TO 20
      IF((MOVED.EQ.2).AND.(JUSTIN.EQ.0)) CALL ATTACK
	MOVED=1
	GO TO 2500
C--------RAISE OR LOWER DEFLECTOR SHIELDS 
 600  CALL SHIELDS
      IF(IDIDIT .EQ. 0) GO TO 20
      CALL ATTACK 
      SHLDCHG=0 
      GO TO 320 
C--------DOCK AT STARBASE 
 700  CALL DOCK 
      IF(IDIDIT.NE.0) GO TO 310
	GO TO 20
C--------LOOK AT DAMAGE REPORT
 800  CALL DREPORT
      GO TO 20
C--------LOOK AT STAR CHART 
 900  CALL CHART
      GO TO 20
C--------MOVE UNDER IMPULSE POWER 
 1000 IF(MOVED.NE.0) GO TO 505
      CALL IMPULSE
      GO TO 520 
C--------REST AND REPAIR
 1100 CALL WAIT 
      GO TO 410 
C--------CHANGE WARP FACTOR 
 1200 CALL SETWARP
      GO TO 20
C--------ASK FOR STATUS INFORMATION 
 1300 CALL STATUS 
      GO TO 20
C--------GET A SENSOR SCAN OF QUADRANT. 
 1400 CALL SENSOR 
      GO TO 20
C--------ENTER STANDARD ORBIT.
 1450 CALL ORBIT
      GO TO 410 
C--------TRANSPORT SOMEBODY SOMEWHERE.
 1500 CALL BEAM 
      GO TO 20
C--------DO A LITTLE DIGGING. 
 1550 CALL MINE 
      GO TO 410 
C--------LOAD SOME CRYSTALS (AND HOPE FOR THE BEST.)
 1600 CALL CRYSTAL
      GO TO 20
C--------GO FOR A SPIN IN GALILEO.
 1650 CALL GALILEO
      GO TO 410 
C--------GET A PLANET LIST
 1670 CALL PLANET 
      GO TO 20
C--------INDIVIDUAL PIECE OF INFORMATION FROM STATUS REQUESTED. 
 1680 CALL REQUEST
      GO TO 20
C--------EMERGENCY EXIT - FREEZE ON EMSAVE.TRK AND BUG OUT
 1685 CALL EMEXIT
      GO TO 20
C--------GAME - TYPE OUT INFORMATION ON CURRENT GAME
 1690 CALL GAME
      GO TO 20
C--------CALL STARBASE FOR HELP 
 1700 CALL HELP 
      GO TO 20
C--------ABANDON SHIP 
 1900 CALL ABANDON
      GO TO 20
C--------SELF-DESTRUCT
 2000 CALL DESTRCT
      GO TO 20
C--------FREEZE THE CURRENT GAME
 2100 CALL FREEZE 
      IF(IDIDIT.EQ.1) GO TO 9999 
	GO TO 20
C--------TRY A DESPERATION MEASURE
 2200 CALL DEATHRA
      GO TO 305 
C--------AFTER COMMANDS WHICH MAY USE TIME, DO CHECKING 
 2500 IF(ALLDONE.NE.0) GO TO 9999 
      IF(TIME .NE. 0.) CALL EVENTS 
      IF(ALLDONE.NE.0) GO TO 9999 
      IF(GALAXY(QUADX,QUADY) .NE. 1000) GO TO 2510
      CALL AUTOVER
	KDIDIT=0
	MOVED=0
      GO TO 2500
C--------CHECK FOR MOVE AND FIRE OPTION 
2510  IF(NENHERE.EQ.0) CALL MOVETHO   
      IF(KDIDIT .EQ. 1  .OR.  NENHERE .EQ. 0) GO TO 15    
      IF(MOVED .EQ. 0  .OR. JUSTIN .EQ. 1) GO TO 310 
	GO TO 20
C--------GAME HAS ENDED.  START NEW GAME OR FINALIZE. 
9000	CALL SCORE
9999	IF(LUN.EQ.2)CALL CLOSE(2)
	LUN=1
      CALL SKIP(2)
      CALL STARS
      CALL SKIP(1)
      CALL PROMPT(30HDO YOU WANT TO PLAY AGAIN?    ,30) 
      IF(JA(DUMMY)) GO TO 10
      CALL SKIP(1)
      CALL PROUT( 
     +   48HMAY THE GREAT BIRD OF THE GALAXY ROOST UPON YOUR,48) 
      CALL PROUT(12HHOME PLANET.,12) 
      CALL SKIP(1)
C     IF(ICITE .EQ. 0) GO TO 99999
C     CALL PROUT(52HDON'T FORGET TO TYPE <RSF> TO RECEIVE YOUR CITATION.      
C    C,52)
99999	CALL EXIT
	END
