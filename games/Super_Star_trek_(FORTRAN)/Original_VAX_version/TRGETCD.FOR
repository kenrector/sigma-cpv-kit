      SUBROUTINE GETCD
	INCLUDE 'TREKCOM/NOLIST'
	LOGICAL*2 CROP
	REAL*8 AITEM
	COMMON/SCANBF/KEY,AITEM
	EQUIVALENCE (FNUM,AITEM)
C        GET COURSE <DIREC> AND DISTANCE <DIST>.  IF USER TYPES 
C        BAD VALUES, RETURN WITH <DIREC>=-1.0 . 
C--------CHECK TO MAKE SURE NO ONE IS LEFT ON A PLANET. 
      IF(LANDED .NE. 1) GO TO 1 
      CALL PROUT(41H YOU CAN'T LEAVE STANDARD ORBIT UNTIL YOU ,41) 
      CALL CRAM(20HARE BACK ABOARD THE )
	CALL CRAMSHP
	CALL CRAMDMP(1H.)
	GO TO 71
1	IROWQ=QUADX
	ICOLQ=QUADY
	DELTX=0.
	DELTY=0.
	ITEMP=0
      IPROMPT=0 
C--------CHECK FOR MANUAL OR AUTOMATIC. 
10    CALL SCAN 
	IF(KEY.EQ.IHREAL) GOTO 24	!DEFAULT MANUAL MODE
      IF(KEY .EQ. IHALPHA) GO TO 13 
      IF(DAMAGE(11) .NE. 0) GO TO 1301
 11   CALL MANORA 
      IPROMPT=1 
      GO TO 10
 13   IF (CROP(AITEM,6HMANUAL)) GO TO 20 
      IF (.NOT.CROP(AITEM,7HAUTOMAT)) GO TO 11 
C--------AUTOMATIC MOVEMENT REQUESTED.  CHECK FOR COMPUTER DAMAGE.
      IF(DAMAGE(11).EQ.0) GO TO 14
 1301 CALL PROUT(41HCOMPUTER DAMAGED; MANUAL MOVEMENT ONLY.      ,41)
      GO TO 2001
C--------GET QUADRANT AND SECTOR. 
 14   CALL SCAN 
	XI=FNUM
      IF(KEY.NE.IHEOL) GO TO 15 
 1410 CALL PROMPT(40HDESTINATION QUADRANT AND/OR SECTOR:     ,40)
      IPROMPT=1 
      GO TO 14
 15   IF (KEY .NE. IHREAL) GO TO 1410 
	IF(FNUM.EQ.-1.) GO TO 71
      CALL SCAN 
	XJ=FNUM
      IF(KEY.NE.IHREAL) GO TO 1410
      CALL SCAN
	XK=FNUM
      IF (KEY .NE. IHREAL) GO TO 16 
      CALL SCAN
	XL=FNUM
      IF (KEY .NE. IHREAL) GO TO 1410 
C--------QUADRANT AND SECTOR SPECIFIED. 
	IROWQ=XI+.5
	ICOLQ=XJ+.5
	IROWS=XK+.5
	ICOLS=XL+.5
	GO TO 30
C--------ONLY SECTOR SPECIFIED. 
16	IROWS=XI+.5
	ICOLS=XJ+.5
	ITEMP=1
	GO TO 30
C--------MANUAL (DELTX, DELTY) MOVEMENT.
 20   CALL SCAN
      IF(KEY .EQ. IHREAL) GO TO 24
 2001 CALL PROMPT(30HX AND Y DISPLACEMENTS:        ,30) 
      IPROMPT=1 
      GO TO 20
24	DELTX=FNUM
	CALL SCAN
	IF(DELTX.EQ.-1..AND.KEY.EQ.IHEOL) GO TO 71
	IF(KEY .NE. IHREAL) GO TO 70
	DELTY=FNUM
	GO TO 40
C--------CHECK FOR INVALID INPUT FOR AUTOMATIC CASE.
 30   IF((IROWQ.LT.1) .OR. (IROWQ.GT.8) .OR. (ICOLQ.LT.1) .OR.
     C(ICOLQ.GT.8) .OR. (IROWS.LT.1) .OR. (IROWS.GT.10) .OR.
     C(ICOLS.LT.1) .OR. (ICOLS.GT.10) ) GO TO 70
C--------PRINT MESSAGE FROM APPROPRIATE OFFICER.
      IF(ITEMP .EQ. 1) GO TO 31 
      CALL PROUT(42HENSIGN CHEKOV:  "COURSE LAID IN, CAPTAIN."   ,42)
      GO TO 32
 31   IF(IPROMPT .NE. 1) GO TO 32 
      CALL CRAM(37HHELMSMAN SULU:  "COURSE LOCKED IN FOR) 
      CALL CRAMLOC(2,IROWS,ICOLS) 
      CALL CRAMDMP(2H.")
C--------CONVERT TO DELTX, DELTY FORM.
 32   DELTX = ICOLQ -QUADY +0.1*(ICOLS-SECTY) 
      DELTY = QUADX -IROWQ + 0.1*(SECTX -IROWS) 
C--------CHECK FOR A ZERO MOVEMENT. 
 40   IF((DELTX .NE. 0.) .OR. (DELTY .NE. 0.)) GO TO 42 
      GO TO 71
 42   IF(IPROMPT .EQ. 0) GO TO 43 
      CALL PROUT(27HHELMSMAN SULU:  "AYE, SIR."  ,27)
C--------CONVERT INTO COURSE AND DISTANCE.
 43   DIST = SQRT(DELTX*DELTX+DELTY*DELTY)
      DIREC = ATAN2(DELTX,DELTY)*1.90985932 
      IF(DIREC .LT. 0.) DIREC=12.+DIREC 
      RETURN
C--------GARBAGE IN, GARBAGE OUT
 70   CALL SKIP(1)
      CALL BEGPARD
 71   DIREC=-1.0
      RETURN
      END 
